From f81cdb70914c37fdfe7ea31cf8092aab79bdf063 Mon Sep 17 00:00:00 2001
From: i l <il@il.com>
Date: Mon, 23 Jun 2025 10:35:20 -0400
Subject: [PATCH 23/24] kernel: Linx 6.6.95-rc2

https://lore.kernel.org/all/20250623130626.910356556@linuxfoundation.org
https://lore.kernel.org/all/20250624121409.093630364@linuxfoundation.org

---
 scripts/projectsmirrors.json                  |  1 +
 ...01-v6.16-mips-Add-std-flag-specified.patch | 44 -------------------
 ...wnand-qcom-cleanup-qcom_nandc-driver.patch |  2 +-
 ...d-qcom-Add-qcom-prefix-to-common-api.patch |  2 +-
 ...klog-NAPI-to-clean-up-the-defer_list.patch |  2 +-
 ...-create-a-dummy-net_device-allocator.patch |  2 +-
 ...-a-separate-timeout-parameter-for-wa.patch |  4 +-
 ...-mhi_power_down_keep_dev-API-to-supp.patch |  6 +--
 .../800-GPIO-add-named-gpio-exports.patch     |  2 +-
 .../generic/hack-6.6/902-debloat_proc.patch   |  2 +-
 target/linux/generic/kernel-6.6               |  4 +-
 .../pending-6.6/532-jffs2_eofdetect.patch     |  2 +-
 .../810-uvc-add-iPassion-iP2970-support.patch |  2 +-
 13 files changed, 16 insertions(+), 59 deletions(-)
 delete mode 100644 target/linux/generic/backport-6.6/201-v6.16-mips-Add-std-flag-specified.patch

diff --git a/scripts/projectsmirrors.json b/scripts/projectsmirrors.json
index 9bc2d7ac10..c10054c170 100644
--- a/scripts/projectsmirrors.json
+++ b/scripts/projectsmirrors.json
@@ -63,6 +63,7 @@
 		"https://mirrors.ustc.edu.cn/gnome/sources"
 	],
 	"@OPENWRT": [
+		"https://github.com/mj22226/linux/releases/download/v6.6/",
 		"https://sources.cdn.openwrt.org",
 		"https://sources.openwrt.org",
 		"https://mirror2.openwrt.org/sources"
diff --git a/target/linux/generic/backport-6.6/201-v6.16-mips-Add-std-flag-specified.patch b/target/linux/generic/backport-6.6/201-v6.16-mips-Add-std-flag-specified.patch
deleted file mode 100644
index ae7bfb1dc5..0000000000
--- a/target/linux/generic/backport-6.6/201-v6.16-mips-Add-std-flag-specified.patch
+++ /dev/null
@@ -1,44 +0,0 @@
-From 0f4ae7c6ecb89bfda026d210dcf8216fb67d2333 Mon Sep 17 00:00:00 2001
-From: Khem Raj <raj.khem@gmail.com>
-Date: Sat, 29 Mar 2025 08:39:03 -0700
-Subject: mips: Add -std= flag specified in KBUILD_CFLAGS to vdso CFLAGS
-
-GCC 15 changed the default C standard dialect from gnu17 to gnu23,
-which should not have impacted the kernel because it explicitly requests
-the gnu11 standard in the main Makefile. However, mips/vdso code uses
-its own CFLAGS without a '-std=' value, which break with this dialect
-change because of the kernel's own definitions of bool, false, and true
-conflicting with the C23 reserved keywords.
-
-  include/linux/stddef.h:11:9: error: cannot use keyword 'false' as enumeration constant
-     11 |         false   = 0,
-        |         ^~~~~
-  include/linux/stddef.h:11:9: note: 'false' is a keyword with '-std=c23' onwards
-  include/linux/types.h:35:33: error: 'bool' cannot be defined via 'typedef'
-     35 | typedef _Bool                   bool;
-        |                                 ^~~~
-  include/linux/types.h:35:33: note: 'bool' is a keyword with '-std=c23' onwards
-
-Add -std as specified in KBUILD_CFLAGS to the decompressor and purgatory
-CFLAGS to eliminate these errors and make the C standard version of these
-areas match the rest of the kernel.
-
-Signed-off-by: Khem Raj <raj.khem@gmail.com>
-Cc: stable@vger.kernel.org
-Signed-off-by: Thomas Bogendoerfer <tsbogend@alpha.franken.de>
----
- arch/mips/vdso/Makefile | 1 +
- 1 file changed, 1 insertion(+)
-
-(limited to 'arch/mips/vdso')
-
---- a/arch/mips/vdso/Makefile
-+++ b/arch/mips/vdso/Makefile
-@@ -30,6 +30,7 @@ endif
- # offsets.
- cflags-vdso := $(ccflags-vdso) \
- 	$(filter -W%,$(filter-out -Wa$(comma)%,$(KBUILD_CFLAGS))) \
-+	$(filter -std=%,$(KBUILD_CFLAGS)) \
- 	-O3 -g -fPIC -fno-strict-aliasing -fno-common -fno-builtin -G 0 \
- 	-mrelax-pic-calls $(call cc-option, -mexplicit-relocs) \
- 	-fno-stack-protector -fno-jump-tables -DDISABLE_BRANCH_PROFILING \
diff --git a/target/linux/generic/backport-6.6/413-01-v6.14-mtd-rawnand-qcom-cleanup-qcom_nandc-driver.patch b/target/linux/generic/backport-6.6/413-01-v6.14-mtd-rawnand-qcom-cleanup-qcom_nandc-driver.patch
index 8c5457a507..95b66071ad 100644
--- a/target/linux/generic/backport-6.6/413-01-v6.14-mtd-rawnand-qcom-cleanup-qcom_nandc-driver.patch
+++ b/target/linux/generic/backport-6.6/413-01-v6.14-mtd-rawnand-qcom-cleanup-qcom_nandc-driver.patch
@@ -902,7 +902,7 @@ Signed-off-by: Miquel Raynal <miquel.raynal@bootlin.com>
 +		write_reg_dma(nandc, &nandc->regs->cmd1, NAND_DEV_CMD1, 1, NAND_BAM_NEXT_SGL);
  	}
  
- 	nandc->buf_count = len;
+ 	nandc->buf_count = 512;
 @@ -2926,9 +2877,10 @@ static int qcom_param_page_type_exec(str
  		      nandc->buf_count, 0);
  
diff --git a/target/linux/generic/backport-6.6/413-02-v6.14-mtd-rawnand-qcom-Add-qcom-prefix-to-common-api.patch b/target/linux/generic/backport-6.6/413-02-v6.14-mtd-rawnand-qcom-Add-qcom-prefix-to-common-api.patch
index 078a56cf16..f634e0442a 100644
--- a/target/linux/generic/backport-6.6/413-02-v6.14-mtd-rawnand-qcom-Add-qcom-prefix-to-common-api.patch
+++ b/target/linux/generic/backport-6.6/413-02-v6.14-mtd-rawnand-qcom-Add-qcom-prefix-to-common-api.patch
@@ -844,7 +844,7 @@ Signed-off-by: Miquel Raynal <miquel.raynal@bootlin.com>
 +		qcom_write_reg_dma(nandc, &nandc->regs->cmd1, NAND_DEV_CMD1, 1, NAND_BAM_NEXT_SGL);
  	}
  
- 	nandc->buf_count = len;
+ 	nandc->buf_count = 512;
 @@ -2873,17 +2873,17 @@ static int qcom_param_page_type_exec(str
  
  	config_nand_single_cw_page_read(chip, false, 0);
diff --git a/target/linux/generic/backport-6.6/602-v6.10-net-Use-backlog-NAPI-to-clean-up-the-defer_list.patch b/target/linux/generic/backport-6.6/602-v6.10-net-Use-backlog-NAPI-to-clean-up-the-defer_list.patch
index d38231684d..b721a16f18 100644
--- a/target/linux/generic/backport-6.6/602-v6.10-net-Use-backlog-NAPI-to-clean-up-the-defer_list.patch
+++ b/target/linux/generic/backport-6.6/602-v6.10-net-Use-backlog-NAPI-to-clean-up-the-defer_list.patch
@@ -36,7 +36,7 @@ Signed-off-by: Paolo Abeni <pabeni@redhat.com>
 
 --- a/include/linux/netdevice.h
 +++ b/include/linux/netdevice.h
-@@ -3308,6 +3308,7 @@ static inline void dev_xmit_recursion_de
+@@ -3309,6 +3309,7 @@ static inline void dev_xmit_recursion_de
  	__this_cpu_dec(softnet_data.xmit.recursion);
  }
  
diff --git a/target/linux/generic/backport-6.6/700-v6.10-net-create-a-dummy-net_device-allocator.patch b/target/linux/generic/backport-6.6/700-v6.10-net-create-a-dummy-net_device-allocator.patch
index 9e0bd14acf..efc6412177 100644
--- a/target/linux/generic/backport-6.6/700-v6.10-net-create-a-dummy-net_device-allocator.patch
+++ b/target/linux/generic/backport-6.6/700-v6.10-net-create-a-dummy-net_device-allocator.patch
@@ -37,7 +37,7 @@ Signed-off-by: David S. Miller <davem@davemloft.net>
 
 --- a/include/linux/netdevice.h
 +++ b/include/linux/netdevice.h
-@@ -4580,6 +4580,9 @@ static inline void netif_addr_unlock_bh(
+@@ -4581,6 +4581,9 @@ static inline void netif_addr_unlock_bh(
  
  void ether_setup(struct net_device *dev);
  
diff --git a/target/linux/generic/backport-6.6/850-v6.8-bus-mhi-host-Add-a-separate-timeout-parameter-for-wa.patch b/target/linux/generic/backport-6.6/850-v6.8-bus-mhi-host-Add-a-separate-timeout-parameter-for-wa.patch
index 94d9bcd93d..4aad22248a 100644
--- a/target/linux/generic/backport-6.6/850-v6.8-bus-mhi-host-Add-a-separate-timeout-parameter-for-wa.patch
+++ b/target/linux/generic/backport-6.6/850-v6.8-bus-mhi-host-Add-a-separate-timeout-parameter-for-wa.patch
@@ -109,7 +109,7 @@ Signed-off-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
  			if (ret)
  				dev_err(dev, "Device failed to enter READY state\n");
  		}
-@@ -1125,7 +1130,8 @@ int mhi_async_power_up(struct mhi_contro
+@@ -1141,7 +1146,8 @@ int mhi_async_power_up(struct mhi_contro
  	if (state == MHI_STATE_SYS_ERR) {
  		mhi_set_mhi_state(mhi_cntrl, MHI_STATE_RESET);
  		ret = mhi_poll_reg_field(mhi_cntrl, mhi_cntrl->regs, MHICTRL,
@@ -119,7 +119,7 @@ Signed-off-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
  		if (ret) {
  			dev_info(dev, "Failed to reset MHI due to syserr state\n");
  			goto error_exit;
-@@ -1216,14 +1222,18 @@ EXPORT_SYMBOL_GPL(mhi_power_down);
+@@ -1232,14 +1238,18 @@ EXPORT_SYMBOL_GPL(mhi_power_down);
  int mhi_sync_power_up(struct mhi_controller *mhi_cntrl)
  {
  	int ret = mhi_async_power_up(mhi_cntrl);
diff --git a/target/linux/generic/backport-6.6/853-v6.10-bus-mhi-host-Add-mhi_power_down_keep_dev-API-to-supp.patch b/target/linux/generic/backport-6.6/853-v6.10-bus-mhi-host-Add-mhi_power_down_keep_dev-API-to-supp.patch
index 75c87e378b..0c952bcfd6 100644
--- a/target/linux/generic/backport-6.6/853-v6.10-bus-mhi-host-Add-mhi_power_down_keep_dev-API-to-supp.patch
+++ b/target/linux/generic/backport-6.6/853-v6.10-bus-mhi-host-Add-mhi_power_down_keep_dev-API-to-supp.patch
@@ -115,7 +115,7 @@ Signed-off-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
  
  	mutex_lock(&mhi_cntrl->pm_mutex);
  
-@@ -820,7 +829,10 @@ void mhi_pm_st_worker(struct work_struct
+@@ -836,7 +845,10 @@ void mhi_pm_st_worker(struct work_struct
  			mhi_pm_sys_error_transition(mhi_cntrl);
  			break;
  		case DEV_ST_TRANSITION_DISABLE:
@@ -127,7 +127,7 @@ Signed-off-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
  			break;
  		default:
  			break;
-@@ -1174,7 +1186,8 @@ error_exit:
+@@ -1190,7 +1202,8 @@ error_exit:
  }
  EXPORT_SYMBOL_GPL(mhi_async_power_up);
  
@@ -137,7 +137,7 @@ Signed-off-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
  {
  	enum mhi_pm_state cur_state, transition_state;
  	struct device *dev = &mhi_cntrl->mhi_dev->dev;
-@@ -1210,15 +1223,32 @@ void mhi_power_down(struct mhi_controlle
+@@ -1226,15 +1239,32 @@ void mhi_power_down(struct mhi_controlle
  	write_unlock_irq(&mhi_cntrl->pm_lock);
  	mutex_unlock(&mhi_cntrl->pm_mutex);
  
diff --git a/target/linux/generic/hack-6.6/800-GPIO-add-named-gpio-exports.patch b/target/linux/generic/hack-6.6/800-GPIO-add-named-gpio-exports.patch
index e6dcdfd92b..9c3696e76a 100644
--- a/target/linux/generic/hack-6.6/800-GPIO-add-named-gpio-exports.patch
+++ b/target/linux/generic/hack-6.6/800-GPIO-add-named-gpio-exports.patch
@@ -15,7 +15,7 @@ Signed-off-by: John Crispin <blogic@openwrt.org>
  
  #include "gpiolib.h"
  #include "gpiolib-of.h"
-@@ -1129,3 +1131,73 @@ void of_gpiochip_remove(struct gpio_chip
+@@ -1138,3 +1140,73 @@ void of_gpiochip_remove(struct gpio_chip
  {
  	of_node_put(dev_of_node(&chip->gpiodev->dev));
  }
diff --git a/target/linux/generic/hack-6.6/902-debloat_proc.patch b/target/linux/generic/hack-6.6/902-debloat_proc.patch
index e426c008d0..64472ad18f 100644
--- a/target/linux/generic/hack-6.6/902-debloat_proc.patch
+++ b/target/linux/generic/hack-6.6/902-debloat_proc.patch
@@ -396,7 +396,7 @@ Signed-off-by: Felix Fietkau <nbd@nbd.name>
  }
 --- a/net/ipv4/route.c
 +++ b/net/ipv4/route.c
-@@ -381,6 +381,9 @@ static struct pernet_operations ip_rt_pr
+@@ -385,6 +385,9 @@ static struct pernet_operations ip_rt_pr
  
  static int __init ip_rt_proc_init(void)
  {
diff --git a/target/linux/generic/kernel-6.6 b/target/linux/generic/kernel-6.6
index a2e954d002..32f6c10837 100644
--- a/target/linux/generic/kernel-6.6
+++ b/target/linux/generic/kernel-6.6
@@ -1,2 +1,2 @@
-LINUX_VERSION-6.6 = .94
-LINUX_KERNEL_HASH-6.6.94 = 713981ea26b20b476ba4ce880b76b21294576788d5db1c2188b167bcb06ecc56
+LINUX_VERSION-6.6 = .95
+LINUX_KERNEL_HASH-6.6.95 = d3e179995bd53eb2c330842ad7c7924d3a3d5ce277298e73e22fa9349a3dc8bf
diff --git a/target/linux/generic/pending-6.6/532-jffs2_eofdetect.patch b/target/linux/generic/pending-6.6/532-jffs2_eofdetect.patch
index 744fbd0e21..88bb14a02a 100644
--- a/target/linux/generic/pending-6.6/532-jffs2_eofdetect.patch
+++ b/target/linux/generic/pending-6.6/532-jffs2_eofdetect.patch
@@ -45,7 +45,7 @@ Signed-off-by: Felix Fietkau <nbd@nbd.name>
  
  		if (ret < 0)
  			goto out;
-@@ -567,6 +573,17 @@ full_scan:
+@@ -569,6 +575,17 @@ full_scan:
  			return err;
  	}
  
diff --git a/target/linux/ramips/patches-6.6/810-uvc-add-iPassion-iP2970-support.patch b/target/linux/ramips/patches-6.6/810-uvc-add-iPassion-iP2970-support.patch
index 01ecb16aeb..6c6cff13c9 100644
--- a/target/linux/ramips/patches-6.6/810-uvc-add-iPassion-iP2970-support.patch
+++ b/target/linux/ramips/patches-6.6/810-uvc-add-iPassion-iP2970-support.patch
@@ -13,7 +13,7 @@ Signed-off-by: John Crispin <blogic@openwrt.org>
 
 --- a/drivers/media/usb/uvc/uvc_driver.c
 +++ b/drivers/media/usb/uvc/uvc_driver.c
-@@ -3296,6 +3296,18 @@ static const struct usb_device_id uvc_id
+@@ -3307,6 +3307,18 @@ static const struct usb_device_id uvc_id
  	  .bInterfaceSubClass	= 1,
  	  .bInterfaceProtocol	= 0,
  	  .driver_info		= UVC_INFO_META(V4L2_META_FMT_D4XX) },
-- 
2.46.0

